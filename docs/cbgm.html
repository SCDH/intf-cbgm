

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CBGM &mdash; NTG 0.1.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="_static/my_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installation" href="install.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> NTG
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#web-application">Web Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#scripts">Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#links">Links</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">CBGM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preparing-the-database-for-the-cbgm">Preparing the Database for the CBGM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#applying-the-cbgm">Applying the CBGM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#new-project">New Project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#new-phases">New Phases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#new-phases-with-apparatus-updates">New Phases With Apparatus Updates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install-linux.html">Installation on Linux</a><ul>
<li class="toctree-l3"><a class="reference internal" href="install-linux.html#install-prerequisites">Install Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-linux.html#database-access">Database Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-linux.html#application-server">Application server</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-linux.html#cbgm">CBGM</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-linux.html#run-server">Run Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-linux.html#build-and-run-client">Build and run client</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="install-docker.html">Installation with Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="install-docker.html#install">Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-docker.html#running-the-web-application">Running the web application</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-docker.html#running-the-cbgm">Running the CBGM</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-docker.html#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user.html">User Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="client_user.html">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="server_user.html">Server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="server_user.html#server-main-py">server/__main__.py</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="scripts_user.html">Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="scripts_user.html#scripts-cceh-import-py">scripts/cceh/import.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripts_user.html#scripts-cceh-prepare-py">scripts/cceh/prepare.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripts_user.html#scripts-cceh-cbgm-py">scripts/cceh/cbgm.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripts_user.html#scripts-cceh-save-edits-py">scripts/cceh/save_edits.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripts_user.html#scripts-cceh-load-edits-py">scripts/cceh/load_edits.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripts_user.html#scripts-cceh-mk-users-py">scripts/cceh/mk_users.py</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="domain.html">Introduction to the Problem Domain (German)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="domain.html#das-neue-testament">Das Neue Testament</a></li>
<li class="toctree-l3"><a class="reference internal" href="domain.html#editionen">Editionen</a></li>
<li class="toctree-l3"><a class="reference internal" href="domain.html#die-textzeugen">Die Textzeugen</a></li>
<li class="toctree-l3"><a class="reference internal" href="domain.html#textformen-texttypen">Textformen (Texttypen)</a></li>
<li class="toctree-l3"><a class="reference internal" href="domain.html#textkritik">Textkritik</a></li>
<li class="toctree-l3"><a class="reference internal" href="domain.html#terminologie">Terminologie</a></li>
<li class="toctree-l3"><a class="reference internal" href="domain.html#literatur">Literatur</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="client_dev.html">Web Client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-app">client/app</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-apparatus">client/apparatus</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-checks-list">client/checks_list</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-coherence">client/coherence</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-comparison">client/comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-comparison-details-table">client/comparison_details_table</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-comparison-table">client/comparison_table</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-d3-chord-layout">client/d3_chord_layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-d3-common">client/d3_common</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-d3-stemma-layout">client/d3_stemma_layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-find-relatives">client/find_relatives</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-flash-messages">client/flash_messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-leitzeile">client/leitzeile</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-local-stemma">client/local_stemma</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-notes">client/notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-notes-list">client/notes_list</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-optimal-substemma">client/optimal_substemma</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-optimal-substemma-details">client/optimal_substemma_details</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-page-header">client/page_header</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-project-list">client/project_list</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-relatives-metrics">client/relatives_metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-relatives-table">client/relatives_table</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-set-cover">client/set_cover</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-table-sort-mixin">client/table_sort_mixin</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-table-toggle-mixin">client/table_toggle_mixin</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-textflow">client/textflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-tools">client/tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-widgets-autocomplete">client/widgets/autocomplete</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-widgets-button-group">client/widgets/button_group</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-widgets-card">client/widgets/card</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-widgets-card-caption">client/widgets/card_caption</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-widgets-connectivity">client/widgets/connectivity</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-widgets-context-menu">client/widgets/context_menu</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-widgets-dropdown-mixin">client/widgets/dropdown_mixin</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-widgets-labezator">client/widgets/labezator</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-widgets-navigator">client/widgets/navigator</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-widgets-range">client/widgets/range</a></li>
<li class="toctree-l3"><a class="reference internal" href="client_dev.html#client-widgets-toolbar">client/widgets/toolbar</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="server_dev.html">API Server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="server_dev.html#module-server">server</a></li>
<li class="toctree-l3"><a class="reference internal" href="server_dev.html#module-server.main">server.main</a></li>
<li class="toctree-l3"><a class="reference internal" href="server_dev.html#module-server.textflow">server.textflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="server_dev.html#module-server.comparison">server.comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="server_dev.html#module-server.set_cover">server.set_cover</a></li>
<li class="toctree-l3"><a class="reference internal" href="server_dev.html#module-server.editor">server.editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="server_dev.html#module-server.login">server.login</a></li>
<li class="toctree-l3"><a class="reference internal" href="server_dev.html#module-server.helpers">server.helpers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="server_config.html">API Server Configuration Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="server_config.html#per-application-configuration-files">Per-Application Configuration Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="server_config.html#global-configuration-file">Global Configuration File</a></li>
<li class="toctree-l3"><a class="reference internal" href="server_config.html#footnotes">Footnotes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_management.html">User Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_management.html#manual-user-management">Manual User Management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="scripts_dev.html">Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="scripts_dev.html#module-scripts.cceh.import">scripts.cceh.import</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripts_dev.html#module-scripts.cceh.prepare">scripts.cceh.prepare</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripts_dev.html#module-scripts.cceh.cbgm">scripts.cceh.cbgm</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripts_dev.html#module-scripts.cceh.save_edits">scripts.cceh.save_edits</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripts_dev.html#module-scripts.cceh.load_edits">scripts.cceh.load_edits</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripts_dev.html#module-scripts.cceh.mk_users">scripts.cceh.mk_users</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="database.html">Database Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="database.html#cbgm-database">CBGM Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="database.html#source-database">Source Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="database.html#literature">Literature</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ntg_common.html">Various Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ntg_common.html#module-ntg_common.db_tools">ntg_common.db_tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="ntg_common.html#module-ntg_common.tools">ntg_common.tools</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="technologies.html">Technologies Used</a><ul>
<li class="toctree-l3"><a class="reference internal" href="technologies.html#server">Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="technologies.html#client">Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="technologies.html#common">Common</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NTG</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>CBGM</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/cbgm.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cbgm">
<span id="id1"></span><h1>CBGM<a class="headerlink" href="#cbgm" title="Permalink to this headline">¶</a></h1>
<div class="section" id="preparing-the-database-for-the-cbgm">
<h2>Preparing the Database for the CBGM<a class="headerlink" href="#preparing-the-database-for-the-cbgm" title="Permalink to this headline">¶</a></h2>
<p>All input data must be converted and imported into one Postgres database.</p>
<ul class="simple">
<li><p>The mysql database “ECM” contains the apparatus of the <em>Editio
Critica Maior</em> publication.
This database is exported from the NTVMR application
(New Testament Virtual Manuscript Room).</p></li>
<li><p>The mysql database “Leitzeile” contains the Leitzeile of the
current Nestle-Aland edition or any other appropriate “Leitzeile”.</p></li>
<li><p>Optionally the mysql database “VarGen” contains
previous editorial decisions regarding the priority of the readings.
If this database is not supplied default priorities are used.</p></li>
</ul>
<div class="figure align-center" id="id4">
<div  class="pic pic-format-dot">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="362px" preserveAspectRatio="none" style="width:381px;height:362px;" version="1.1" viewBox="0 0 381 362" width="381px" zoomAndPan="magnify"><defs><filter height="300%" id="f6witmvmxh5um" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[a09e890d9cf6c6dd92f16829561ddf3b]
entity dbsrc1--><path d="M100,18 C100,8 125.5,8 125.5,8 C125.5,8 151,8 151,18 L151,43.2969 C151,53.2969 125.5,53.2969 125.5,53.2969 C125.5,53.2969 100,53.2969 100,43.2969 L100,18 " fill="#FEFECE" filter="url(#f6witmvmxh5um)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M100,18 C100,28 125.5,28 125.5,28 C125.5,28 151,28 151,18 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="110" y="44.9951">ECM</text><!--MD5=[7d63862b52a36b6665604f25716fc8eb]
entity dbsrc2--><path d="M186.5,18 C186.5,8 224.5,8 224.5,8 C224.5,8 262.5,8 262.5,18 L262.5,43.2969 C262.5,53.2969 224.5,53.2969 224.5,53.2969 C224.5,53.2969 186.5,53.2969 186.5,43.2969 L186.5,18 " fill="#FEFECE" filter="url(#f6witmvmxh5um)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M186.5,18 C186.5,28 224.5,28 224.5,28 C224.5,28 262.5,28 262.5,18 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="196.5" y="44.9951">Leitzeile</text><!--MD5=[96357831773e3601c2424f417933b234]
entity dbsrc3--><path d="M298,18 C298,8 333.5,8 333.5,8 C333.5,8 369,8 369,18 L369,43.2969 C369,53.2969 333.5,53.2969 333.5,53.2969 C333.5,53.2969 298,53.2969 298,43.2969 L298,18 " fill="#FEFECE" filter="url(#f6witmvmxh5um)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M298,18 C298,28 333.5,28 333.5,28 C333.5,28 369,28 369,18 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="308" y="44.9951">VarGen</text><path d="M6,18 L6,43.1328 A0,0 0 0 0 6,43.1328 L65,43.1328 A0,0 0 0 0 65,43.1328 L65,36 L99.99,30.5 L65,28 L65,28 L55,18 L6,18 A0,0 0 0 0 6,18 " fill="#FBFB77" filter="url(#f6witmvmxh5um)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M55,18 L55,28 L65,28 L55,18 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="12" y="35.0669">mysql</text><!--MD5=[6b4bfa9e00b0b9cc08101d1a1ff13128]
entity import--><rect fill="#FEFECE" filter="url(#f6witmvmxh5um)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="182.5" y="113"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="177.5" y="118"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="177.5" y="139.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="192.5" y="135.9951">import.py</text><!--MD5=[6921483303ceaa8b08d66e7f0bec6faf]
entity prepare--><rect fill="#FEFECE" filter="url(#f6witmvmxh5um)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="177.5" y="209"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="172.5" y="214"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="172.5" y="235.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="187.5" y="231.9951">prepare.py</text><!--MD5=[7468467f3b6b392f1d176d828c753b77]
entity db--><path d="M199.5,315 C199.5,305 224.5,305 224.5,305 C224.5,305 249.5,305 249.5,315 L249.5,340.2969 C249.5,350.2969 224.5,350.2969 224.5,350.2969 C224.5,350.2969 199.5,350.2969 199.5,340.2969 L199.5,315 " fill="#FEFECE" filter="url(#f6witmvmxh5um)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M199.5,315 C199.5,325 224.5,325 224.5,325 C224.5,325 249.5,325 249.5,315 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="209.5" y="341.9951">Acts</text><path d="M87,315 L87,340.1328 A0,0 0 0 0 87,340.1328 L164,340.1328 A0,0 0 0 0 164,340.1328 L164,333 L199.05,327.5 L164,325 L164,325 L154,315 L87,315 A0,0 0 0 0 87,315 " fill="#FBFB77" filter="url(#f6witmvmxh5um)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M154,315 L154,325 L164,325 L154,315 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="93" y="332.0669">Postgres</text><!--MD5=[06153d669ba4a6091edc55114736c23a]
link dbsrc1 to import--><path d="M147.47,53.36 C164.21,70.01 187.1,92.79 203.57,109.18 " fill="none" id="dbsrc1-&gt;import" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="207.19,112.78,203.6359,103.5948,203.6473,109.2516,197.9905,109.263,207.19,112.78" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[1181806e114f4b3efc6dc9b5cc5253ec]
link dbsrc2 to import--><path d="M224.5,53.36 C224.5,69.45 224.5,91.26 224.5,107.5 " fill="none" id="dbsrc2-&gt;import" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="224.5,112.78,228.5,103.78,224.5,107.78,220.5,103.78,224.5,112.78" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[8366de4ce307ed482a2c0322a7c6885b]
link dbsrc3 to import--><path d="M309.58,53.12 C291.17,69.75 265.87,92.61 247.66,109.07 " fill="none" id="dbsrc3-&gt;import" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="243.65,112.69,253.009,109.6226,247.3594,109.3373,247.6447,103.6876,243.65,112.69" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[c0911d2e3ff2220116761a4b114330c6]
link import to prepare--><path d="M224.5,149.24 C224.5,164.48 224.5,186.81 224.5,203.46 " fill="none" id="import-&gt;prepare" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="224.5,208.87,228.5,199.87,224.5,203.87,220.5,199.87,224.5,208.87" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[f2ecf892a456a737d9315cbf0a56c5ce]
link prepare to db--><path d="M224.5,245.16 C224.5,260.14 224.5,282.15 224.5,299.5 " fill="none" id="prepare-&gt;db" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="224.5,304.72,228.5,295.72,224.5,299.72,220.5,295.72,224.5,304.72" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[7350b5c0cb67e39f503fc3e092c5e789]
@startuml
skinparam backgroundColor transparent

database  "ECM"        as dbsrc1
database  "Leitzeile"  as dbsrc2
database  "VarGen"     as dbsrc3
note left of dbsrc1: mysql

component "import.py"  as import
component "prepare.py" as prepare
database  "Acts"       as db
note left of db: Postgres

dbsrc1  - -> import
dbsrc2  - -> import
dbsrc3  - -> import
import  - -> prepare
prepare - -> db
@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.7+10-post-Debian-3
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg></div>
<p class="caption"><span class="caption-text">Database Preparation for CBGM</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>The <a class="reference internal" href="scripts_user.html#import-py"><span class="std std-ref">scripts/cceh/import.py</span></a> script copies the mysql databases into temporary tables of the
postgres database without doing any integrity checking.
The temporary tables are named “original_*”.
These tables are very useful for finding and understanding data errors.</p>
<p>The <a class="reference internal" href="scripts_user.html#prepare-py"><span class="std std-ref">scripts/cceh/prepare.py</span></a> script reads the temporary tables in the Postgres database and
writes tables in a <span class="xref std std-ref">&lt;cbgm-db database structure&gt;</span> suitable for doing the CBGM.
This structure is normalized and data integrity is enforced.</p>
<p>All data integrity errors that surface at this point must be fixed in the source
data before the database can be fully prepared.  Then the source data must be
imported again. This is an iterative and very time-consuming process.</p>
<p>This process needs to be done only once for each project.</p>
<p>The databases for John and Mark are imported in a similar way.  Each team has a
different workflow, and uses a different structure in their input databases.
The prepare.py script tries to accomodate all those differences by special
casing.  See the source.</p>
</div>
<div class="section" id="applying-the-cbgm">
<h2>Applying the CBGM<a class="headerlink" href="#applying-the-cbgm" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="scripts_user.html#cbgm-py"><span class="std std-ref">scripts/cceh/cbgm.py</span></a> script recalculates the CBGM.  Whenever a local stemma changes,
the CBGM coefficients have to be recalculated.  This process must be run
immediately after the <a class="reference internal" href="scripts_user.html#prepare-py"><span class="std std-ref">scripts/cceh/prepare.py</span></a> script.</p>
<div class="figure align-center" id="id5">
<div  class="pic pic-format-dot">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="65px" preserveAspectRatio="none" style="width:203px;height:65px;" version="1.1" viewBox="0 0 203 65" width="203px" zoomAndPan="magnify"><defs><filter height="300%" id="f1xu1wwfs278ts" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[a7c658c4e382d375c7bed7cfd253cf1d]
entity cbgm--><rect fill="#FEFECE" filter="url(#f1xu1wwfs278ts)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="101" x="91.5" y="12.5"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="86.5" y="17.5"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="86.5" y="38.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="101.5" y="35.4951">cbgm script</text><!--MD5=[7468467f3b6b392f1d176d828c753b77]
entity db--><path d="M6,18 C6,8 31,8 31,8 C31,8 56,8 56,18 L56,43.2969 C56,53.2969 31,53.2969 31,53.2969 C31,53.2969 6,53.2969 6,43.2969 L6,18 " fill="#FEFECE" filter="url(#f1xu1wwfs278ts)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M6,18 C6,28 31,28 31,28 C31,28 56,28 56,18 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="16" y="44.9951">Acts</text><!--MD5=[01a8732ff988ece8f7fe2e1f25b3371e]
link db to cbgm--><path d="M56.15,42.33 C66.14,45.65 76.14,47.33 86.13,47.37 " fill="none" id="db-&gt;cbgm" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="91.36,47.25,82.2602,43.4827,86.3617,47.3785,82.4658,51.48,91.36,47.25" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[fce18b097a0e10776d903d164d89fdcf]
reverse link db to cbgm--><path d="M61.1,17.16 C71.19,14.35 81.27,13.22 91.36,13.75 " fill="none" id="db&lt;-cbgm" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="56.15,18.67,65.9259,19.8669,60.932,17.2096,63.5893,12.2158,56.15,18.67" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[b189dfe880e09e17158c66676ca88891]
@startuml
skinparam backgroundColor transparent

component "cbgm script" as cbgm
database  "Acts"        as db

db -> cbgm
db <- cbgm
@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.7+10-post-Debian-3
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg></div>
<p class="caption"><span class="caption-text">Applying the CBGM</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="new-project">
<h2>New Project<a class="headerlink" href="#new-project" title="Permalink to this headline">¶</a></h2>
<p>A new project is created.</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>As an example let us create a new project: Matthew Phase 1.</p>
<p>ssh into the server and create an empty Postgres database:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo -u ntg bash
psql -c <span class="s2">&quot;CREATE DATABASE mt_ph1&quot;</span>
</pre></div>
</div>
<p>Now create local mysql databases:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysql -e <span class="s2">&quot;CREATE DATABASE ECM_MtPh1&quot;</span>
mysql -e <span class="s2">&quot;CREATE DATABASE VarGenAtt_MtPh1&quot;</span>
mysql -e <span class="s2">&quot;CREATE DATABASE Nestle29&quot;</span>
</pre></div>
</div>
<p>And fill them with data.
You probably got these database dumps from the NTVMR people.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat ECM_MtPh1.dump.sql       <span class="p">|</span> mysql -D ECM_MtPh1
cat VarGenAtt_MtPh1.dump.sql <span class="p">|</span> mysql -D VarGenAtt_MtPh1
cat Nestle29.dump.sql        <span class="p">|</span> mysql -D Nestle29
</pre></div>
</div>
<p>Then create a new server instance.
The fastest way is to just copy an old instance configuration file and edit it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/prj/ntg/ntg/instance
cp acts_ph4.conf mt_ph1.conf
emacs mt_ph1.conf
</pre></div>
</div>
<p>Change all relevant parts of the instance configuration file.</p>
<p>Use the <a class="reference internal" href="scripts_user.html#import-py"><span class="std std-ref">scripts/cceh/import.py</span></a> and <a class="reference internal" href="scripts_user.html#prepare-py"><span class="std std-ref">scripts/cceh/prepare.py</span></a> scripts to import
the mysql databases into Postgres and prepare them for CBGM,
then do the CBGM with the <a class="reference internal" href="scripts_user.html#cbgm-py"><span class="std std-ref">scripts/cceh/cbgm.py</span></a> script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/prj/ntg/ntg
python3 -m scripts.cceh.import  -vvv instance/mt_ph1.conf
python3 -m scripts.cceh.prepare -vvv instance/mt_ph1.conf
python3 -m scripts.cceh.cbgm    -vvv instance/mt_ph1.conf
</pre></div>
</div>
<p>Last, restart the application server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo /bin/systemctl restart ntg
</pre></div>
</div>
<p>If the server doesn’t start, check for configuration errors:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo /bin/journalctl -u ntg
</pre></div>
</div>
</div>
</div>
<div class="section" id="new-phases">
<h2>New Phases<a class="headerlink" href="#new-phases" title="Permalink to this headline">¶</a></h2>
<p>A new phase of the project is entered after the editors have completed a pass
over the whole text.
All editorial decisions taken during this pass are used to recalculate
the CBGM for the next phase.</p>
<p>To start a new phase:</p>
<ul class="simple">
<li><p>copy the database into a new database,</p></li>
<li><p>add an instance to the server, and</p></li>
<li><p>run the CBGM on the new instance.</p></li>
</ul>
<div class="section" id="id2">
<h3>Example<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>As an example let us create a new Acts Phase 5 from an existing Acts Phase 4.</p>
<p>ssh into the server and
stop the application server and make a copy of the acts_ph4 database:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo -u ntg bash
sudo /bin/systemctl stop ntg
psql -c <span class="s2">&quot;CREATE DATABASE acts_ph5 WITH TEMPLATE acts_ph4&quot;</span>
sudo /bin/systemctl start ntg
</pre></div>
</div>
<p>Then create a new server instance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/prj/ntg/ntg/instance
cp acts_ph4.conf acts_ph5.conf
emacs acts_ph5.conf
</pre></div>
</div>
<p>Change all relevant parts of the configuration file. Then run the CBGM on the <em>new</em> instance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/prj/ntg/ntg
python3 -m scripts.cceh.cbgm -vvv instance/acts_ph5.conf
</pre></div>
</div>
<p>Last, restart the application server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo /bin/systemctl restart ntg
</pre></div>
</div>
</div>
</div>
<div class="section" id="new-phases-with-apparatus-updates">
<h2>New Phases With Apparatus Updates<a class="headerlink" href="#new-phases-with-apparatus-updates" title="Permalink to this headline">¶</a></h2>
<p>Sometimes a new phase goes hand in hand with a change in the apparatus.</p>
<p>To update the apparatus while maintaining (most) editorial decisions:</p>
<ul class="simple">
<li><p>create a new databse for the phase,</p></li>
<li><p>add an instance to the server,</p></li>
<li><p>prepare a new database with the new apparatus,</p></li>
<li><p>save the editorial decisions from the old database,</p></li>
<li><p>load the editorial decisions into the new database, and</p></li>
<li><p>run the CBGM on the new instance.</p></li>
</ul>
<div class="section" id="id3">
<h3>Example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>As an example let us create a new Acts Phase 6 from an existing Acts Phase 5
using a new apparatus.</p>
<p>ssh into the server and create a new database for the new phase:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo -u ntg bash
psql -c <span class="s2">&quot;CREATE DATABASE acts_ph6&quot;</span>
</pre></div>
</div>
<p>Then create a new server instance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/prj/ntg/ntg/instance
cp acts_ph5.conf acts_ph6.conf
emacs acts_ph6.conf
</pre></div>
</div>
<p>Change all relevant parts of the configuration file.</p>
<p>Now import the new apparatus: follow the steps in <a class="reference internal" href="#new-project">New Project</a> above.</p>
<p>Then use the <a class="reference internal" href="scripts_user.html#save-edits-py"><span class="std std-ref">scripts/cceh/save_edits.py</span></a> script to save the editorial decisions
of the previous instance and the <a class="reference internal" href="scripts_user.html#load-edits-py"><span class="std std-ref">scripts/cceh/load_edits.py</span></a> script to load them
into the new instance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/prj/ntg/ntg
python3 -m scripts.cceh.save_edits -vvv -o saved_edits.xml instance/acts_ph5.conf
python3 -m scripts.cceh.load_edits -vvv -i saved_edits.xml instance/acts_ph6.conf
</pre></div>
</div>
<p>The last command will also output a list of passages in the old apparatus
that are missing or different in the new apparatus and store them
in the file <code class="file docutils literal notranslate"><span class="pre">load_edits.log</span></code>.</p>
<p>Then run the <a class="reference internal" href="scripts_user.html#cbgm-py"><span class="std std-ref">scripts/cceh/cbgm.py</span></a> script on the <em>new</em> instance to apply the CBGM method:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m scripts.cceh.cbgm -vvv instance/acts_ph6.conf
</pre></div>
</div>
<p>Last, restart the application server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo /bin/systemctl restart ntg
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="install.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="intro.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-19 CCeH - Licensed under the GNU GPL v3 or later

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>